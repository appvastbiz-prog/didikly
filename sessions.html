<!DOCTYPE html>
<html>
<body>

<h2>My Sessions</h2>

<ul id="list"></ul>

<script type="module">

  import { requireRole } from "./guard.js";

  const access = await requireRole(["student", "tutor"]);
  if (!access.ok) {
    document.body.innerHTML = "Access denied";
    throw new Error("Blocked");
  }

  import { supabase } from "./supabase.js";

  async function loadSessions() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { data: sessions } = await supabase
      .from("sessions")
      .select("*")
      .or(`student_id.eq.${user.id},tutor_id.eq.${user.id}`)
      .eq("status", "accepted");

    const list = document.getElementById("list");

    sessions.forEach(s => {
      const li = document.createElement("li");
      const role = s.student_id === user.id ? "Student" : "Tutor";
      li.innerHTML = `
        Role: ${role} |
        Mode: ${s.mode} |
        Session ID: ${s.id.slice(-6)}
        <a href="/session.html?id=${s.id}">Join</a>
      `;
      list.appendChild(li);
    });
  }

  loadSessions();
</script>

</body>
</html>
